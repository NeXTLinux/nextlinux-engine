<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.75.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x196.png sizes=96x196><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Policy Gate: dockerfile | Anchore Engine</title><meta property="og:title" content="Policy Gate: dockerfile"><meta property="og:description" content="This article reviews the &ldquo;dockerfile&rdquo; gate and its triggers. The dockerfile gate allows users to perform checks on the content of the dockerfile or docker history for an image and make policy actions based on the construction of an image, not just its content. This is particularly useful for enforcing best practices or metadata inclusion (e.g. labels) on images.
Anchore is either given a dockerfile or infers one from the docker image layer history."><meta property="og:type" content="article"><meta property="og:url" content="/docs/usage/cli_usage/policies/policy_gate_dockerfile/"><meta property="article:modified_time" content="2020-11-23T15:52:18-08:00"><meta itemprop=name content="Policy Gate: dockerfile"><meta itemprop=description content="This article reviews the &ldquo;dockerfile&rdquo; gate and its triggers. The dockerfile gate allows users to perform checks on the content of the dockerfile or docker history for an image and make policy actions based on the construction of an image, not just its content. This is particularly useful for enforcing best practices or metadata inclusion (e.g. labels) on images.
Anchore is either given a dockerfile or infers one from the docker image layer history."><meta itemprop=dateModified content="2020-11-23T15:52:18-08:00"><meta itemprop=wordCount content="2610"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Policy Gate: dockerfile"><meta name=twitter:description content="This article reviews the &ldquo;dockerfile&rdquo; gate and its triggers. The dockerfile gate allows users to perform checks on the content of the dockerfile or docker history for an image and make policy actions based on the construction of an image, not just its content. This is particularly useful for enforcing best practices or metadata inclusion (e.g. labels) on images.
Anchore is either given a dockerfile or infers one from the docker image layer history."><link rel=preload href=/scss/main.min.937e83c369c498b6459fa907d495c576482035c5e1427c3f3d67ef3dd2f2e0a6.css as=style><link href=/scss/main.min.937e83c369c498b6459fa907d495c576482035c5e1427c3f3d67ef3dd2f2e0a6.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.3.1.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script><title>Policy Gate: dockerfile | Anchore Engine</title></head><body class=td-page><header><nav class="navbar navbar-expand navbar-dark bg-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg height="38" viewBox="0 0 144 38" width="144" xmlns="http://www.w3.org/2000/svg"><g fill="#fff" fill-rule="evenodd"><path d="m9.016 34.799c-3.135.0-5.41-1.812-5.41-4.31.0-2.283 1.249-2.984 3.88-3.613l5.469-1.466c.725-.161 1.246-.351 1.6-.587l-.13 4.491v.005c0 4.946-3.783 5.48-5.409 5.48zm0-23.306c-4.041.0-7.511 2.335-8.641 5.847-.047.445.068 1.251 1.376 1.655 1.434.441 1.963-.297 2.155-.784.744-2.139 2.75-3.522 5.11-3.522 3.216.0 5.551 2.151 5.551 5.113v1.27c0 .594-.794.981-1.543 1.147l-6.385 1.668c-4.777 1.088-6.639 2.939-6.639 6.602.0 4.282 3.876 7.511 9.016 7.511 5.476.0 9.015-3.347 9.015-8.526l.141-9.721c0-4.786-3.85-8.26-9.156-8.26z"/><path d="m59.434 28.434c-1.144-.161-1.853.334-1.961.91-.46 2.521-2.769 4.351-5.489 4.351-3.387.0-5.576-2.372-5.576-6.042v-6.884c0-3.67 2.189-6.042 5.576-6.042 2.721.0 5.029 1.83 5.489 4.352.108.574.81 1.068 1.961.909.635-.089 1.138-.348 1.419-.728.188-.254.265-.553.218-.848-.738-4.009-4.559-6.919-9.087-6.919-4.441.0-9.221 2.821-9.221 9.016v7.404c0 6.195 4.78 9.016 9.221 9.016 4.528.0 8.349-2.91 9.087-6.924.047-.29-.03-.59-.218-.844-.281-.38-.785-.638-1.419-.727"/><path d="m100.722 27.567c0 3.67-2.19 6.041-5.58 6.041-3.388.0-5.577-2.371-5.577-6.041v-6.798c0-3.67 2.189-6.042 5.577-6.042 3.39.0 5.58 2.372 5.58 6.042zm-5.58-16.074c-4.441.0-9.221 2.821-9.221 9.016v7.313c0 6.195 4.78 9.017 9.221 9.017 4.443.0 9.225-2.822 9.225-9.017v-7.313c0-6.195-4.782-9.016-9.225-9.016z"/><path d="m30.419 11.493c-4.441.0-9.221 2.821-9.221 9.016v14.056c0 .19.042.356.079.479l.064.216.195-.113c1.542-.897 2.682-2.262 3.296-3.95l.011-10.428c0-3.67 2.188-6.042 5.576-6.042 3.39.0 5.581 2.372 5.581 6.042v7.536l.013.068c.659 1.605 1.823 2.901 3.368 3.746l.263.144V20.509c0-6.195-4.781-9.016-9.225-9.016"/><path d="m73.429 11.493c-2.061.0-4.028.581-5.581 1.644V2.112c0-.964-.664-1.516-1.822-1.516s-1.822.552-1.822 1.516v30.151l.263-.144c1.545-.846 2.709-2.141 3.368-3.746l.013-7.604c0-3.67 2.191-6.042 5.581-6.042 3.388.0 5.576 2.372 5.576 6.042v10.366l.011.061c.614 1.688 1.754 3.054 3.296 3.951l.195.113.065-.217c.036-.123.078-.289.078-.478V20.509c0-6.195-4.78-9.016-9.221-9.016"/><path d="m124.05 14.965c-1.615-2.419-4.647-3.368-7.014-3.456v-.016l-.32.003-.062-.003-.178.008v.004c-6.103.196-8.838 4.645-8.838 9.004v14.056c0 .189.041.355.078.478l.064.217.196-.113c1.541-.897 2.681-2.263 3.296-3.951l.01-10.427c0-3.628 2.159-5.996 5.495-6.035 1.726.032 3.161.716 4.264 2.034.672.81 1.44.943 2.288.396.93-.6 1.201-1.42.725-2.193z"/><path d="m136.514 22.618-5.469 1.465c-.726.161-1.248.352-1.601.588l.131-4.492v-.005c0-4.946 3.783-5.48 5.409-5.48 3.135.0 5.41 1.812 5.41 4.31.0 2.283-1.25 2.984-3.88 3.614zm5.735 7.88c-1.432-.44-1.963.298-2.155.784-.744 2.139-2.75 3.522-5.11 3.522-3.216.0-5.551-2.151-5.551-5.113v-1.27c0-.593.793-.981 1.543-1.147l6.384-1.668c4.778-1.087 6.64-2.939 6.64-6.602.0-4.282-3.876-7.511-9.016-7.511-5.476.0-9.015 3.347-9.015 8.526l-.142 9.721c0 4.786 3.851 8.26 9.157 8.26 4.041.0 7.511-2.335 8.64-5.847.058-.543-.133-1.272-1.375-1.655z"/></g></svg></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder=Search aria-label=Search autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder=Search aria-label=Search autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav pt-2 pl-4" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Anchore Engine Documentation</a></li><ul><li class="collapse show" id=docs><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/grype/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Grype Vulnerability Scanner</a></li><ul><li class=collapse id=docsgrype></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/quickstart/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Quickstart</a></li><ul><li class=collapse id=docsquickstart></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/general/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Overview</a></li><ul><li class=collapse id=docsgeneral><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/general/concepts/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Concepts</a></li><ul><li class=collapse id=docsgeneralconcepts><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/general/concepts/accessing_engine/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Access</a></li><ul><li class=collapse id=docsgeneralconceptsaccessing_engine></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/general/concepts/images/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Images</a></li><ul><li class=collapse id=docsgeneralconceptsimages><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/general/concepts/images/analysis/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Image Analysis</a></li><ul><li class=collapse id=docsgeneralconceptsimagesanalysis><a class="td-sidebar-link td-sidebar-link__page" id=m-docsgeneralconceptsimagesanalysismalware_scanning href=/docs/general/concepts/images/analysis/malware_scanning/>Malware Scanning</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsgeneralconceptsimagesanalysiscontent_hints href=/docs/general/concepts/images/analysis/content_hints/>Content Hints</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/general/concepts/images/watchers/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Watching Images</a></li><ul><li class=collapse id=docsgeneralconceptsimageswatchers></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/general/concepts/policy/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Policy</a></li><ul><li class=collapse id=docsgeneralconceptspolicy><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/general/concepts/policy/bundles/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Policy Bundles</a></li><ul><li class=collapse id=docsgeneralconceptspolicybundles></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-docsgeneralconceptspolicypolicy_mappings href=/docs/general/concepts/policy/policy_mappings/>Policy Mappings</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsgeneralconceptspolicywhitelists href=/docs/general/concepts/policy/whitelists/>Whitelists</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/general/concepts/policy/policies/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Policies</a></li><ul><li class=collapse id=docsgeneralconceptspolicypolicies></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-docsgeneralconceptspolicypolicy_checks href=/docs/general/concepts/policy/policy_checks/>Policy Checks</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/general/concepts/analysis_archive/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Analysis Archive</a></li><ul><li class=collapse id=docsgeneralconceptsanalysis_archive></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/general/concepts/registries/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Registries</a></li><ul><li class=collapse id=docsgeneralconceptsregistries></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/general/concepts/subscriptions/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Subscriptions</a></li><ul><li class=collapse id=docsgeneralconceptssubscriptions></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/general/concepts/integrations/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Integrations</a></li><ul><li class=collapse id=docsgeneralconceptsintegrations><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/general/concepts/integrations/ci_cd/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">CI / CD Integration</a></li><ul><li class=collapse id=docsgeneralconceptsintegrationsci_cd></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/general/concepts/integrations/kubernetes/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Kubernetes Integration</a></li><ul><li class=collapse id=docsgeneralconceptsintegrationskubernetes></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/general/concepts/authorization_plugins/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Authorization Plugins</a></li><ul><li class=collapse id=docsgeneralconceptsauthorization_plugins></li></ul></ul></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/install/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Installing</a></li><ul><li class=collapse id=docsinstall><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/install/docker_compose/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Docker Compose</a></li><ul><li class=collapse id=docsinstalldocker_compose></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/install/helm/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Kubernetes</a></li><ul><li class=collapse id=docsinstallhelm><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/install/helm/amazon_marketplace/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Amazon Marketplace</a></li><ul><li class=collapse id=docsinstallhelmamazon_marketplace></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/install/nextlinux_cli/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Anchore CLI</a></li><ul><li class=collapse id=docsinstallnextlinux_cli><a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallnextlinux_clicli_config href=/docs/install/nextlinux_cli/cli_config/>Configuring the Anchore CLI</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallnextlinux_clicli_upgrade href=/docs/install/nextlinux_cli/cli_upgrade/>Upgrading the Anchore CLI</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/install/requirements/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Requirements</a></li><ul><li class=collapse id=docsinstallrequirements><a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallrequirementsdatabase href=/docs/install/requirements/database/>Database</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallrequirementsmemory href=/docs/install/requirements/memory/>Memory</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallrequirementsnetwork href=/docs/install/requirements/network/>Network</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallrequirementssecurity href=/docs/install/requirements/security/>Security</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallrequirementsstorage href=/docs/install/requirements/storage/>Storage</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/install/configuration/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Configuration</a></li><ul><li class=collapse id=docsinstallconfiguration><a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallconfigurationfeed_configuration href=/docs/install/configuration/feed_configuration/>Configuration</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallconfigurationconfig href=/docs/install/configuration/config/>General</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallconfigurationcustom_certs href=/docs/install/configuration/custom_certs/>Custom Certificates</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallconfigurationtls_ssl_config href=/docs/install/configuration/tls_ssl_config/>TLS / SSL</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallconfigurationuser_credential_storage href=/docs/install/configuration/user_credential_storage/>Configuring User Credential Storage</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallconfigurationcontent_hints href=/docs/install/configuration/content_hints/>Configuring Content Hints</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallconfigurationmax_image_size href=/docs/install/configuration/max_image_size/>Max Image Size</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallconfigurationnetwork_proxies href=/docs/install/configuration/network_proxies/>Network Proxies</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallconfigurationusing_env_vars href=/docs/install/configuration/using_env_vars/>Environment Variables</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallconfigurationmalware href=/docs/install/configuration/malware/>Configuring Malware Scanning</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/install/storage/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Storage</a></li><ul><li class=collapse id=docsinstallstorage><a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallstorageanalysis_archive href=/docs/install/storage/analysis_archive/>Analysis Archive</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallstoragedatabase href=/docs/install/storage/database/>Database</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallstoragelayer_caching href=/docs/install/storage/layer_caching/>Layer Caching</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/install/storage/object_store/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Object Storage</a></li><ul><li class=collapse id=docsinstallstorageobject_store><a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallstorageobject_storemigration href=/docs/install/storage/object_store/migration/>Changing Drivers</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallstorageobject_storedatabase_driver href=/docs/install/storage/object_store/database_driver/>Database Driver</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallstorageobject_storefilesystem_driver href=/docs/install/storage/object_store/filesystem_driver/>Filesystem Driver</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallstorageobject_stores3_driver href=/docs/install/storage/object_store/s3_driver/>S3 Object Store Driver</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallstorageobject_storeswift_driver href=/docs/install/storage/object_store/swift_driver/>Swift Archive Driver</a></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/install/upgrade/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Upgrade</a></li><ul><li class=collapse id=docsinstallupgrade></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/install/considerations/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Considerations</a></li><ul><li class=collapse id=docsinstallconsiderations><a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallconsiderationsmac_special_considerations href=/docs/install/considerations/mac_special_considerations/>Considerations for Mac</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsinstallconsiderationsrhel_special_considerations href=/docs/install/considerations/rhel_special_considerations/>Considerations for RHEL</a></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/usage/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Usage</a></li><ul><li class="collapse show" id=docsusage><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/usage/cli_usage/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Using the CLI</a></li><ul><li class="collapse show" id=docsusagecli_usage><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/usage/cli_usage/analysis_archive/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Analysis Archive</a></li><ul><li class=collapse id=docsusagecli_usageanalysis_archive></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/usage/cli_usage/images/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Images</a></li><ul><li class=collapse id=docsusagecli_usageimages><a class="td-sidebar-link td-sidebar-link__page" id=m-docsusagecli_usageimagesinspecting_image_content href=/docs/usage/cli_usage/images/inspecting_image_content/>Inspecting Image Content</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsusagecli_usageimagesviewing_security_vulnerabilities href=/docs/usage/cli_usage/images/viewing_security_vulnerabilities/>Viewing Security Vulnerabilities</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/usage/cli_usage/policies/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Policies</a></li><ul><li class="collapse show" id=docsusagecli_usagepolicies><a class="td-sidebar-link td-sidebar-link__page" id=m-docsusagecli_usagepoliciespolicy_checks href=/docs/usage/cli_usage/policies/policy_checks/>Anchore Policies Checks</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsusagecli_usagepoliciesevaluating_images_against_policies href=/docs/usage/cli_usage/policies/evaluating_images_against_policies/>Evaluating Images Against Policies</a>
<a class="td-sidebar-link td-sidebar-link__page active" id=m-docsusagecli_usagepoliciespolicy_gate_dockerfile href=/docs/usage/cli_usage/policies/policy_gate_dockerfile/>Policy Gate: dockerfile</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/usage/cli_usage/registries/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Registries</a></li><ul><li class=collapse id=docsusagecli_usageregistries><a class="td-sidebar-link td-sidebar-link__page" id=m-docsusagecli_usageregistriesconfiguring_registries href=/docs/usage/cli_usage/registries/configuring_registries/>Configuring Registries</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsusagecli_usageregistriesecr_configuration href=/docs/usage/cli_usage/registries/ecr_configuration/>Working with Amazon ECR Registry Credentials</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsusagecli_usageregistriesacr_configuration href=/docs/usage/cli_usage/registries/acr_configuration/>Working with Azure Registry Credentials</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsusagecli_usageregistriesgcr_configuration href=/docs/usage/cli_usage/registries/gcr_configuration/>Working with Google Container Registry (GCR) Credentials</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/usage/cli_usage/subscriptions/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Subscriptions</a></li><ul><li class=collapse id=docsusagecli_usagesubscriptions></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/usage/cli_usage/repositories/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Repositories</a></li><ul><li class=collapse id=docsusagecli_usagerepositories></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/usage/cli_usage/event/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Events</a></li><ul><li class=collapse id=docsusagecli_usageevent></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/usage/cli_usage/feeds/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Feeds</a></li><ul><li class=collapse id=docsusagecli_usagefeeds><a class="td-sidebar-link td-sidebar-link__page" id=m-docsusagecli_usagefeedsfeed_configuration href=/docs/usage/cli_usage/feeds/feed_configuration/>Configuration</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsusagecli_usagefeedsfeed_synchronization href=/docs/usage/cli_usage/feeds/feed_synchronization/>Synchronization</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/usage/cli_usage/accounts/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">User Management</a></li><ul><li class=collapse id=docsusagecli_usageaccounts></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/usage/api_usage/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Using the API</a></li><ul><li class=collapse id=docsusageapi_usage><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/usage/api_usage/authentication/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Authentication Modes</a></li><ul><li class=collapse id=docsusageapi_usageauthentication></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/usage/integration/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Integration</a></li><ul><li class=collapse id=docsusageintegration><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/usage/integration/ci_cd/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">CI / CD</a></li><ul><li class=collapse id=docsusageintegrationci_cd><a class="td-sidebar-link td-sidebar-link__page" id=m-docsusageintegrationci_cdcircleci href=/docs/usage/integration/ci_cd/circleci/>CircleCI</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsusageintegrationci_cdjenkins href=/docs/usage/integration/ci_cd/jenkins/>Jenkins</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsusageintegrationci_cdgithub href=/docs/usage/integration/ci_cd/github/>GitHub</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsusageintegrationci_cdinline_analysis href=/docs/usage/integration/ci_cd/inline_analysis/>Inline Image Analysis</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsusageintegrationci_cdinline_scanning href=/docs/usage/integration/ci_cd/inline_scanning/>Inline Scanning</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsusageintegrationci_cdgitlab href=/docs/usage/integration/ci_cd/gitlab/>Gitlab</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/usage/integration/kubernetes/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Kubernetes</a></li><ul><li class=collapse id=docsusageintegrationkubernetes></li></ul></ul></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/releasenotes/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Release Notes</a></li><ul><li class=collapse id=docsreleasenotes><a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes110 href=/docs/releasenotes/110/>1.1.0</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes101 href=/docs/releasenotes/101/>1.0.1</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/releasenotes/1.0.0/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">1.0.0</a></li><ul><li class=collapse id=docsreleasenotes100></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes0102 href=/docs/releasenotes/0102/>0.10.2</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes0101 href=/docs/releasenotes/0101/>0.10.1</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes0100 href=/docs/releasenotes/0100/>0.10.0</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes094 href=/docs/releasenotes/094/>0.9.4</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes093 href=/docs/releasenotes/093/>0.9.3</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes092 href=/docs/releasenotes/092/>0.9.2</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes091 href=/docs/releasenotes/091/>0.9.1</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes090 href=/docs/releasenotes/090/>0.9.0</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes082 href=/docs/releasenotes/082/>0.8.2</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes081 href=/docs/releasenotes/081/>0.8.1</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes080 href=/docs/releasenotes/080/>0.8.0</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes073 href=/docs/releasenotes/073/>0.7.3</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes072 href=/docs/releasenotes/072/>0.7.2</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes071 href=/docs/releasenotes/071/>0.7.1</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/releasenotes/0.7.0/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">0.7.0</a></li><ul><li class=collapse id=docsreleasenotes070><a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes070data_matching_rollback href=/docs/releasenotes/0.7.0/data_matching_rollback/>Revert back to RHSA post-0.7.0 upgrade</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes061 href=/docs/releasenotes/061/>0.6.1</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes060 href=/docs/releasenotes/060/>0.6.0</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes052 href=/docs/releasenotes/052/>0.5.2</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes051 href=/docs/releasenotes/051/>0.5.1</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes050 href=/docs/releasenotes/050/>0.5.0</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes042 href=/docs/releasenotes/042/>0.4.2</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes041 href=/docs/releasenotes/041/>0.4.1</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsreleasenotes040 href=/docs/releasenotes/040/>0.4.0</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/data_privacy/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Data Privacy</a></li><ul><li class=collapse id=docsdata_privacy></li></ul></ul></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/nextlinux/nextlinux-engine/edit/master/content/docs/usage/cli_usage/policies/policy_gate_dockerfile.md target=_blank><i class="fa fa-edit fa-fw"></i>Edit this page</a>
<a href="https://github.com/nextlinux/nextlinux-engine/issues/new?title=Policy%20Gate:%20dockerfile" target=_blank><i class="fab fa-github fa-fw"></i>Create issue</a></div><nav id=TableOfContents><ul><li><ul><li><a href=#the-dockerfile>The &ldquo;dockerfile&rdquo;</a></li><li><a href=#trigger-instruction>Trigger: instruction</a></li><li><a href=#trigger-effective_user>Trigger: effective_user</a></li><li><a href=#trigger-exposed_ports>Trigger: exposed_ports</a></li><li><a href=#trigger-no_dockerfile_provided>Trigger: no_dockerfile_provided</a></li></ul></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=/docs/>Anchore Engine Documentation</a></li><li class=breadcrumb-item><a href=/docs/usage/>Usage</a></li><li class=breadcrumb-item><a href=/docs/usage/cli_usage/>Using the CLI</a></li><li class=breadcrumb-item><a href=/docs/usage/cli_usage/policies/>Policies</a></li><li class="breadcrumb-item active" aria-current=page><a href=/docs/usage/cli_usage/policies/policy_gate_dockerfile/>Policy Gate: dockerfile</a></li></ol></nav><div class=td-content><h1>Policy Gate: dockerfile</h1><p>This article reviews the &ldquo;dockerfile&rdquo; gate and its triggers. The dockerfile gate allows users to perform checks on the content of the dockerfile or docker history for an image and make policy actions based on the construction of an image, not just its content. This is particularly useful for enforcing best practices or metadata inclusion (e.g. labels) on images.</p><p>Anchore is either given a dockerfile or infers one from the docker image layer history. There are implications to what data is available and what it means depending on these differing sources, so first, we&rsquo;ll cover the input data for the gate and how it impacts the triggers and parameters used.</p><h3 id=the-dockerfile>The &ldquo;dockerfile&rdquo;</h3><p>The data that this gate operates on can come from two different sources:</p><ol><li>The actual dockerfile used to build an image, as provided by the user at the time of running <code>nextlinux-cli image add &lt;img ref> --dockerfile &lt;filename></code> or the corresponding API call to: POST /images?dockerfile=</li><li>The history from layers as encoded in the image itself (see <code>docker history &lt;img></code> for this output)</li></ol><p>All images have data from history available, but data from the actual dockerfile is only available when a user provides it. This also means that any images analyzed by the tag watcher functionality will not have an actual dockerfile.</p><h4 id=the-from-line>The FROM line</h4><p>In the actual dockerfile, the FROM instruction is preserved and available as used to build the image, however in the history data, the FROM line will always be the very first FROM instruction used to build the image and all of its dependent based image. Thus, for most images, the value in the history will be omitted and Anchore will automatically infer a FROM scratch line, which is logically inserted for this gate if the dockerfile/history does not contain an explicit FROM entry.</p><p>For example, using the docker.io/jenkins/jenkins image:</p><pre><code>IMAGE                                                                     CREATED             CREATED BY                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       SIZE                COMMENT
sha256:3b9c9666a66e53473c05a3c69eb2cb888a8268f76935eecc7530653cddc28981   11 hours ago        /bin/sh -c #(nop) COPY file:3a15c25533fd87983edc33758f62af7b543ccc3ce9dd570e473eb0702f5f298e in /usr/local/bin/install-plugins.sh                                                                                                                                                                                                                                                                                                                                                                                                                                8.79kB              
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop) COPY file:f97999fac8a63cf8b635a54ea84a2bc95ae3da4d81ab55267c92b28b502d8812 in /usr/local/bin/plugins.sh                                                                                                                                                                                                                                                                                                                                                                                                                                        3.96kB              
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ENTRYPOINT [&quot;/sbin/tini&quot; &quot;--&quot; &quot;/usr/local/bin/jenkins.sh&quot;]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop) COPY file:dc942ca949bb159f81bbc954773b3491e433d2d3e3ef90bac80ecf48a313c9c9 in /bin/tini                                                                                                                                                                                                                                                                                                                                                                                                                                                        529B                
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop) COPY file:a8f986413b77bf4d88562b9d3a0dce98ab6e75403192aa4d4153fb41f450843d in /usr/local/bin/jenkins.sh                                                                                                                                                                                                                                                                                                                                                                                                                                        1.45kB              
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop) COPY file:55594d9d2aed007553a6743a43039b1a48b30527f8fb991ad93e1fd5b1298f60 in /usr/local/bin/jenkins-support                                                                                                                                                                                                                                                                                                                                                                                                                                   6.12kB              
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  USER jenkins                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ENV COPY_REFERENCE_FILE_LOG=/var/jenkins_home/copy_reference_file.log                                                                                                                                                                                                                                                                                                                                                                                                                                                                         0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  EXPOSE 50000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  EXPOSE 8080                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0B                  
&lt;missing&gt;                                                                 11 hours ago        |9 JENKINS_SHA=e026221efcec9528498019b6c1581cca70fe9c3f6b10303777d85c6699bca0e4 JENKINS_URL=https://repo.jenkins-ci.org/public/org/jenkins-ci/main/jenkins-war/2.161/jenkins-war-2.161.war TINI_VERSION=v0.16.1 agent_port=50000 gid=1000 group=jenkins http_port=8080 uid=1000 user=jenkins /bin/sh -c chown -R ${user} &quot;$JENKINS_HOME&quot; /usr/share/jenkins/ref                                                                                                                                                                                                  328B                
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ENV JENKINS_INCREMENTALS_REPO_MIRROR=https://repo.jenkins-ci.org/incrementals                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ENV JENKINS_UC_EXPERIMENTAL=https://updates.jenkins.io/experimental                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ENV JENKINS_UC=https://updates.jenkins.io                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0B                  
&lt;missing&gt;                                                                 11 hours ago        |9 JENKINS_SHA=e026221efcec9528498019b6c1581cca70fe9c3f6b10303777d85c6699bca0e4 JENKINS_URL=https://repo.jenkins-ci.org/public/org/jenkins-ci/main/jenkins-war/2.161/jenkins-war-2.161.war TINI_VERSION=v0.16.1 agent_port=50000 gid=1000 group=jenkins http_port=8080 uid=1000 user=jenkins /bin/sh -c curl -fsSL ${JENKINS_URL} -o /usr/share/jenkins/jenkins.war   &amp;&amp; echo &quot;${JENKINS_SHA}  /usr/share/jenkins/jenkins.war&quot; | sha256sum -c -                                                                                                                  76MB                
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ARG JENKINS_URL=https://repo.jenkins-ci.org/public/org/jenkins-ci/main/jenkins-war/2.161/jenkins-war-2.161.war                                                                                                                                                                                                                                                                                                                                                                                                                                0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ARG JENKINS_SHA=5bb075b81a3929ceada4e960049e37df5f15a1e3cfc9dc24d749858e70b48919                                                                                                                                                                                                                                                                                                                                                                                                                                                              0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ENV JENKINS_VERSION=2.161                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ARG JENKINS_VERSION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop) COPY file:c84b91c835048a52bb864c1f4662607c56befe3c4b1520b0ea94633103a4554f in /usr/share/jenkins/ref/init.groovy.d/tcp-slave-agent-port.groovy                                                                                                                                                                                                                                                                                                                                                                                                 328B                
&lt;missing&gt;                                                                 11 hours ago        |7 TINI_VERSION=v0.16.1 agent_port=50000 gid=1000 group=jenkins http_port=8080 uid=1000 user=jenkins /bin/sh -c curl -fsSL https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini-static-$(dpkg --print-architecture) -o /sbin/tini   &amp;&amp; curl -fsSL https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini-static-$(dpkg --print-architecture).asc -o /sbin/tini.asc   &amp;&amp; gpg --no-tty --import ${JENKINS_HOME}/tini_pub.gpg   &amp;&amp; gpg --verify /sbin/tini.asc   &amp;&amp; rm -rf /sbin/tini.asc /root/.gnupg   &amp;&amp; chmod +x /sbin/tini   866kB               
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop) COPY file:653491cb486e752a4c2b4b407a46ec75646a54eabb597634b25c7c2b82a31424 in /var/jenkins_home/tini_pub.gpg                                                                                                                                                                                                                                                                                                                                                                                                                                   7.15kB              
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ARG TINI_VERSION=v0.16.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0B                  
&lt;missing&gt;                                                                 11 hours ago        |6 agent_port=50000 gid=1000 group=jenkins http_port=8080 uid=1000 user=jenkins /bin/sh -c mkdir -p /usr/share/jenkins/ref/init.groovy.d                                                                                                                                                                                                                                                                                                                                                                                                                         0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  VOLUME [/var/jenkins_home]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0B                  
&lt;missing&gt;                                                                 11 hours ago        |6 agent_port=50000 gid=1000 group=jenkins http_port=8080 uid=1000 user=jenkins /bin/sh -c mkdir -p $JENKINS_HOME   &amp;&amp; chown ${uid}:${gid} $JENKINS_HOME   &amp;&amp; groupadd -g ${gid} ${group}   &amp;&amp; useradd -d &quot;$JENKINS_HOME&quot; -u ${uid} -g ${gid} -m -s /bin/bash ${user}                                                                                                                                                                                                                                                                                            328kB               
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ENV JENKINS_SLAVE_AGENT_PORT=50000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ENV JENKINS_HOME=/var/jenkins_home                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ARG JENKINS_HOME=/var/jenkins_home                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ARG agent_port=50000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ARG http_port=8080                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ARG gid=1000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ARG uid=1000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ARG group=jenkins                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c #(nop)  ARG user=jenkins                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0B                  
&lt;missing&gt;                                                                 11 hours ago        /bin/sh -c apt-get update &amp;&amp; apt-get install -y git curl &amp;&amp; rm -rf /var/lib/apt/lists/*                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0B                  
&lt;missing&gt;                                                                 3 weeks ago         /bin/sh -c set -ex;   if [ ! -d /usr/share/man/man1 ]; then   mkdir -p /usr/share/man/man1;  fi;   apt-get update;  apt-get install -y --no-install-recommends   openjdk-8-jdk=&quot;$JAVA_DEBIAN_VERSION&quot;  ;  rm -rf /var/lib/apt/lists/*;   [ &quot;$(readlink -f &quot;$JAVA_HOME&quot;)&quot; = &quot;$(docker-java-home)&quot; ];   update-alternatives --get-selections | awk -v home=&quot;$(readlink -f &quot;$JAVA_HOME&quot;)&quot; 'index($3, home) == 1 { $2 = &quot;manual&quot;; print | &quot;update-alternatives --set-selections&quot; }';  update-alternatives --query java | grep -q 'Status: manual'                    348MB               
&lt;missing&gt;                                                                 3 weeks ago         /bin/sh -c #(nop)  ENV JAVA_DEBIAN_VERSION=8u181-b13-2~deb9u1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0B                  
&lt;missing&gt;                                                                 3 weeks ago         /bin/sh -c #(nop)  ENV JAVA_VERSION=8u181                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        0B                  
&lt;missing&gt;                                                                 3 weeks ago         /bin/sh -c #(nop)  ENV JAVA_HOME=/docker-java-home                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               0B                  
&lt;missing&gt;                                                                 3 weeks ago         /bin/sh -c ln -svT &quot;/usr/lib/jvm/java-8-openjdk-$(dpkg --print-architecture)&quot; /docker-java-home                                                                                                                                                                                                                                                                                                                                                                                                                                                                  33B                 
&lt;missing&gt;                                                                 3 weeks ago         /bin/sh -c {   echo '#!/bin/sh';   echo 'set -e';   echo;   echo 'dirname &quot;$(dirname &quot;$(readlink -f &quot;$(which javac || which java)&quot;)&quot;)&quot;';  } &gt; /usr/local/bin/docker-java-home  &amp;&amp; chmod +x /usr/local/bin/docker-java-home                                                                                                                                                                                                                                                                                                                                       87B                 
&lt;missing&gt;                                                                 3 weeks ago         /bin/sh -c #(nop)  ENV LANG=C.UTF-8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              0B                  
&lt;missing&gt;                                                                 3 weeks ago         /bin/sh -c apt-get update &amp;&amp; apt-get install -y --no-install-recommends   bzip2   unzip   xz-utils  &amp;&amp; rm -rf /var/lib/apt/lists/*                                                                                                                                                                                                                                                                                                                                                                                                                               2.21MB              
&lt;missing&gt;                                                                 3 weeks ago         /bin/sh -c apt-get update &amp;&amp; apt-get install -y --no-install-recommends   bzr   git   mercurial   openssh-client   subversion     procps  &amp;&amp; rm -rf /var/lib/apt/lists/*                                                                                                                                                                                                                                                                                                                                                                                         142MB               
&lt;missing&gt;                                                                 3 weeks ago         /bin/sh -c set -ex;  if ! command -v gpg &gt; /dev/null; then   apt-get update;   apt-get install -y --no-install-recommends    gnupg    dirmngr   ;   rm -rf /var/lib/apt/lists/*;  fi                                                                                                                                                                                                                                                                                                                                                                             7.81MB              
&lt;missing&gt;                                                                 3 weeks ago         /bin/sh -c apt-get update &amp;&amp; apt-get install -y --no-install-recommends   ca-certificates   curl   netbase   wget  &amp;&amp; rm -rf /var/lib/apt/lists/*                                                                                                                                                                                                                                                                                                                                                                                                                23.2MB              
&lt;missing&gt;                                                                 3 weeks ago         /bin/sh -c #(nop)  CMD [&quot;bash&quot;]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0B                  
&lt;missing&gt;                                                                 3 weeks ago         /bin/sh -c #(nop) ADD file:da71baf0d22cb2ede91c5e3ff959607e47459a9d7bda220a62a3da362b0e59ea in /                                                                                                                                                                                                                                                                                                                                                                                                                                                                 101MB
</code></pre><p>Where the actual dockerfile for that image is:</p><pre><code>FROM openjdk:8-jdk-stretch

RUN apt-get update &amp;&amp; apt-get install -y git curl &amp;&amp; rm -rf /var/lib/apt/lists/*

ARG user=jenkins
ARG group=jenkins
ARG uid=1000
ARG gid=1000
ARG http_port=8080
ARG agent_port=50000
ARG JENKINS_HOME=/var/jenkins_home

ENV JENKINS_HOME $JENKINS_HOME
ENV JENKINS_SLAVE_AGENT_PORT ${agent_port}

# Jenkins is run with user `jenkins`, uid = 1000
# If you bind mount a volume from the host or a data container,
# ensure you use the same uid
RUN mkdir -p $JENKINS_HOME \
  &amp;&amp; chown ${uid}:${gid} $JENKINS_HOME \
  &amp;&amp; groupadd -g ${gid} ${group} \
  &amp;&amp; useradd -d &quot;$JENKINS_HOME&quot; -u ${uid} -g ${gid} -m -s /bin/bash ${user}

# Jenkins home directory is a volume, so configuration and build history
# can be persisted and survive image upgrades
VOLUME $JENKINS_HOME

# `/usr/share/jenkins/ref/` contains all reference configuration we want
# to set on a fresh new installation. Use it to bundle additional plugins
# or config file with your custom jenkins Docker image.
RUN mkdir -p /usr/share/jenkins/ref/init.groovy.d

# Use tini as subreaper in Docker container to adopt zombie processes
ARG TINI_VERSION=v0.16.1
COPY tini_pub.gpg ${JENKINS_HOME}/tini_pub.gpg
RUN curl -fsSL https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini-static-$(dpkg --print-architecture) -o /sbin/tini \
  &amp;&amp; curl -fsSL https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini-static-$(dpkg --print-architecture).asc -o /sbin/tini.asc \
  &amp;&amp; gpg --no-tty --import ${JENKINS_HOME}/tini_pub.gpg \
  &amp;&amp; gpg --verify /sbin/tini.asc \
  &amp;&amp; rm -rf /sbin/tini.asc /root/.gnupg \
  &amp;&amp; chmod +x /sbin/tini

COPY init.groovy /usr/share/jenkins/ref/init.groovy.d/tcp-slave-agent-port.groovy

# jenkins version being bundled in this docker image
ARG JENKINS_VERSION
ENV JENKINS_VERSION ${JENKINS_VERSION:-2.121.1}

# jenkins.war checksum, download will be validated using it
ARG JENKINS_SHA=5bb075b81a3929ceada4e960049e37df5f15a1e3cfc9dc24d749858e70b48919

# Can be used to customize where jenkins.war get downloaded from
ARG JENKINS_URL=https://repo.jenkins-ci.org/public/org/jenkins-ci/main/jenkins-war/${JENKINS_VERSION}/jenkins-war-${JENKINS_VERSION}.war

# could use ADD but this one does not check Last-Modified header neither does it allow to control checksum
# see https://github.com/docker/docker/issues/8331
RUN curl -fsSL ${JENKINS_URL} -o /usr/share/jenkins/jenkins.war \
  &amp;&amp; echo &quot;${JENKINS_SHA}  /usr/share/jenkins/jenkins.war&quot; | sha256sum -c -

ENV JENKINS_UC https://updates.jenkins.io
ENV JENKINS_UC_EXPERIMENTAL=https://updates.jenkins.io/experimental
ENV JENKINS_INCREMENTALS_REPO_MIRROR=https://repo.jenkins-ci.org/incrementals
RUN chown -R ${user} &quot;$JENKINS_HOME&quot; /usr/share/jenkins/ref

# for main web interface:
EXPOSE ${http_port}

# will be used by attached slave agents:
EXPOSE ${agent_port}

ENV COPY_REFERENCE_FILE_LOG $JENKINS_HOME/copy_reference_file.log

USER ${user}

COPY jenkins-support /usr/local/bin/jenkins-support
COPY jenkins.sh /usr/local/bin/jenkins.sh
COPY tini-shim.sh /bin/tini
ENTRYPOINT [&quot;/sbin/tini&quot;, &quot;--&quot;, &quot;/usr/local/bin/jenkins.sh&quot;]

# from a derived Dockerfile, can use `RUN plugins.sh active.txt` to setup /usr/share/jenkins/ref/plugins from a support bundle
COPY plugins.sh /usr/local/bin/plugins.sh
COPY install-plugins.sh /usr/local/bin/install-plugins.sh
</code></pre><p>Anchore will detect the history/dockerfile as this, if not explicitly provided (note order is reversed from docker history output, so it reads in same order as actual dockerfile):</p><pre><code>[
   {
      &quot;Size&quot; : 45323792,
      &quot;Tags&quot; : [],
      &quot;Comment&quot; : &quot;&quot;,
      &quot;Id&quot; : &quot;sha256:cd8eada9c7bb496eb685fc6d2198c33db7cb05daf0fde42e4cf5bf0127cbdf38&quot;,
      &quot;Created&quot; : &quot;2018-12-28T23:29:37.981962131Z&quot;,
      &quot;CreatedBy&quot; : &quot;/bin/sh -c #(nop) ADD file:da71baf0d22cb2ede91c5e3ff959607e47459a9d7bda220a62a3da362b0e59ea in / &quot;
   },
   {
      &quot;Size&quot; : 0,
      &quot;Tags&quot; : [],
      &quot;Comment&quot; : &quot;&quot;,
      &quot;Id&quot; : &quot;&lt;missing&gt;&quot;,
      &quot;Created&quot; : &quot;2018-12-28T23:29:38.226681736Z&quot;,
      &quot;CreatedBy&quot; : &quot;/bin/sh -c #(nop)  CMD [\&quot;bash\&quot;]&quot;
   },
   {
      &quot;Size&quot; : 10780911,
      &quot;Comment&quot; : &quot;&quot;,
      &quot;Tags&quot; : [],
      &quot;CreatedBy&quot; : &quot;/bin/sh -c apt-get update &amp;&amp; apt-get install -y --no-install-recommends \t\tca-certificates \t\tcurl \t\tnetbase \t\twget \t&amp;&amp; rm -rf /var/lib/apt/lists/*&quot;,
      &quot;Created&quot; : &quot;2018-12-29T00:04:28.920875483Z&quot;,
      &quot;Id&quot; : &quot;sha256:c2677faec825930a8844845f55454ee0495ceb5bea9fc904d5b3125de863dc1d&quot;
   },
   {
      &quot;Comment&quot; : &quot;&quot;,
      &quot;Tags&quot; : [],
      &quot;Size&quot; : 4340024,
      &quot;CreatedBy&quot; : &quot;/bin/sh -c set -ex; \tif ! command -v gpg &gt; /dev/null; then \t\tapt-get update; \t\tapt-get install -y --no-install-recommends \t\t\tgnupg \t\t\tdirmngr \t\t; \t\trm -rf /var/lib/apt/lists/*; \tfi&quot;,
      &quot;Created&quot; : &quot;2018-12-29T00:04:34.642152001Z&quot;,
      &quot;Id&quot; : &quot;sha256:fcce419a96b1219a265bf7a933d66b585a6f8d73448533f3833c73ad49fb5e88&quot;
   },
   {
      &quot;Size&quot; : 50062697,
      &quot;Tags&quot; : [],
      &quot;Comment&quot; : &quot;&quot;,
      &quot;Id&quot; : &quot;sha256:045b51e26e750443c84216071a1367a7aae0b76245800629dc04934628b4b1ea&quot;,
      &quot;CreatedBy&quot; : &quot;/bin/sh -c apt-get update &amp;&amp; apt-get install -y --no-install-recommends \t\tbzr \t\tgit \t\tmercurial \t\topenssh-client \t\tsubversion \t\t\t\tprocps \t&amp;&amp; rm -rf /var/lib/apt/lists/*&quot;,
      &quot;Created&quot; : &quot;2018-12-29T00:04:59.676112605Z&quot;
   },
 ... &lt;truncated for brevity&gt; ...
   {
      &quot;Tags&quot; : [],
      &quot;Comment&quot; : &quot;&quot;,
      &quot;Size&quot; : 0,
      &quot;Id&quot; : &quot;&lt;missing&gt;&quot;,
      &quot;CreatedBy&quot; : &quot;/bin/sh -c #(nop)  ENTRYPOINT [\&quot;/sbin/tini\&quot; \&quot;--\&quot; \&quot;/usr/local/bin/jenkins.sh\&quot;]&quot;,
      &quot;Created&quot; : &quot;2019-01-21T08:56:30.737221895Z&quot;
   },
   {
      &quot;Size&quot; : 1549,
      &quot;Tags&quot; : [],
      &quot;Comment&quot; : &quot;&quot;,
      &quot;Id&quot; : &quot;sha256:283cd3aba8691a3b9d22d923de66243b105758e74de7d9469fe55a6a58aeee30&quot;,
      &quot;Created&quot; : &quot;2019-01-21T08:56:32.015667468Z&quot;,
      &quot;CreatedBy&quot; : &quot;/bin/sh -c #(nop) COPY file:f97999fac8a63cf8b635a54ea84a2bc95ae3da4d81ab55267c92b28b502d8812 in /usr/local/bin/plugins.sh &quot;
   },
   {
      &quot;Comment&quot; : &quot;&quot;,
      &quot;Tags&quot; : [],
      &quot;Size&quot; : 3079,
      &quot;Created&quot; : &quot;2019-01-21T08:56:33.158854485Z&quot;,
      &quot;CreatedBy&quot; : &quot;/bin/sh -c #(nop) COPY file:3a15c25533fd87983edc33758f62af7b543ccc3ce9dd570e473eb0702f5f298e in /usr/local/bin/install-plugins.sh &quot;,
      &quot;Id&quot; : &quot;sha256:b0ce8ab5a5a7da5d762f25af970f4423b98437a8318cb9852c3f21354cbf914f&quot;
   }
]
</code></pre><p>NOTE: Anchore processes the leading /bin/sh commands, so you do not have to include those in any trigger param config if using the docker history output.</p><h4 id=the-actual_dockerfile_only-parameter>The actual_dockerfile_only Parameter</h4><p>The actual vs history impacts the semantics of the dockerfile gate&rsquo;s triggers. To allow explicit control of the differences, most triggers in this gate includes a parameter: actual_dockerfile_only that if set to true or false will ensure the trigger check is only done on the source of data specified. If actual_dockerfile_only = true, then the trigger will evaluate only if an actual dockerfile is available for the image and will skip evaluation if not. If actual_dockerfile_only is false or omitted, then the trigger will run on the actual dockerfile if available, or the history data if the dockerfile was not provided.</p><h4 id=differences-in-data-between-docker-history-and-actual-dockerfile>Differences in data between Docker History and actual Dockerfile</h4><p>With Actual Dockerfile:</p><ol><li>FROM line is preserved, so the parent tag of the image is easily available</li><li>Instruction checks are all against instructions created during the build for that exact image, not any parent images<ol><li>When the actual_dockerfile_only parameter is set to true, all instructions from the parent image are ignored in policy processing. This may have some unexpected consequences depending on how your images are structured and layered (e.g. golden base images that establish common patterns of volumes, labels, healthchecks)</li></ol></li><li>COPY/ADD instructions will maintain the actual values used</li><li>Multistage-builds in that specific dockerfile will be visible with multiple FROM lines in the output</li></ol><p>With Docker History data, when no dockerfile is provided:</p><ol><li>FROM line is not accurate, and will nearly always default to &lsquo;FROM scratch&rsquo;</li><li>Instructions are processed from all layers in the image</li><li>COPY and ADD instructions are transformed into SHAs rather than the actual file path/name used at build-time</li><li>Multi-stage builds are not tracked with multiple FROM lines, only the copy operations between the phases</li></ol><h3 id=trigger-instruction>Trigger: instruction</h3><p>This trigger evaluates instructions found in the &ldquo;dockerfile&rdquo;</p><p>Supported Directives/Instructions (as of Anchore Engine v.0.3.2):</p><h4 id=parameters>Parameters</h4><p>actual_dockerfile_only (optional): See above</p><p>instruction: The dockerfile instruction to check against. One of:</p><ul><li>ADD</li><li>ARG</li><li>COPY</li><li>CMD</li><li>ENTRYPOINT</li><li>ENV</li><li>EXPOSE</li><li>FROM</li><li>HEALTHCHECK</li><li>LABEL</li><li>MAINTAINER</li><li>ONBUILD</li><li>USER</li><li>RUN</li><li>SHELL</li><li>STOPSIGNAL</li><li>VOLUME</li><li>WORKDIR</li></ul><p><em>check:</em> The comparison/evaluation to perform. One of: =, != , exists, not_exists, like, not_like, in, not_in.</p><p><em>value</em> (optional): A string value to compare against, if applicable</p><h4 id=examples>Examples</h4><ol><li>Ensure an image has a HEALTHCHECK defined in the image (warn if not found):</li></ol><pre><code>{
  &quot;gate&quot;: &quot;dockerfile&quot;,
  &quot;trigger&quot;: &quot;instruction&quot;, 
  &quot;action&quot;: &quot;warn&quot;, 
  &quot;parameters&quot;: [ 
    {
      &quot;name&quot;: &quot;instruction&quot;,
      &quot;value&quot;: &quot;HEALTHCHECK&quot;
    }, 
    {
      &quot;name&quot;: &quot;check&quot;,
      &quot;value&quot;: &quot;not_exists&quot;
    }
  ]
}
</code></pre><ol start=2><li>Check for AWS environment variables set:</li></ol><pre><code>{
  &quot;gate&quot;: &quot;dockerfile&quot;,
  &quot;trigger&quot;: &quot;instruction&quot;, 
  &quot;action&quot;: &quot;stop&quot;, 
  &quot;parameters&quot;: [ 
    {
      &quot;name&quot;: &quot;instruction&quot;,
      &quot;value&quot;: &quot;ENV&quot;
    }, 
    {
      &quot;name&quot;: &quot;check&quot;,
      &quot;value&quot;: &quot;like&quot;
    },
    {
      &quot;name&quot;: &quot;value&quot;,
      &quot;value&quot;: &quot;AWS_.*KEY&quot;
    }
  ]
}
</code></pre><h3 id=trigger-effective_user>Trigger: effective_user</h3><p>This trigger processes all <code>USER</code> directives in the dockerfile or history to determine which user will be used to run the container by default (assuming no user is set explicitly at runtime). The detected value is then subject to a whitelist or blacklist filter depending on the configured parameters. Typically, this is used for blacklisting the root user.</p><h4 id=parameters-1>Parameters</h4><p><em>actual_dockerfile_only</em> (optional): See above</p><p><em>users:</em> A string with a comma delimited list of username to check for</p><p><em>type:</em> The type of check to perform. One of: &lsquo;blacklist&rsquo; or &lsquo;whitelist&rsquo;. This determines how the value of the &lsquo;users&rsquo; parameter is interpreted.</p><h4 id=examples-1>Examples</h4><ol><li>Blacklist root user</li></ol><pre><code>{
  &quot;gate&quot;: &quot;dockerfile&quot;,
  &quot;trigger&quot;: &quot;effective_user&quot;, 
  &quot;action&quot;: &quot;stop&quot;, 
  &quot;parameters&quot;: [ 
    {
      &quot;name&quot;: &quot;users&quot;,
      &quot;value&quot;: &quot;root&quot;
    }, 
    {
      &quot;name&quot;: &quot;type&quot;,
      &quot;value&quot;: &quot;blacklist&quot;
    }
  ]
}
</code></pre><ol start=2><li>Blacklist root user but only if set in actual dockerfile, not inherited from parent image</li></ol><pre><code>{
  &quot;gate&quot;: &quot;dockerfile&quot;,
  &quot;trigger&quot;: &quot;effective_user&quot;, 
  &quot;action&quot;: &quot;stop&quot;, 
  &quot;parameters&quot;: [ 
    {
      &quot;name&quot;: &quot;users&quot;,
      &quot;value&quot;: &quot;root&quot;
    }, 
    {
      &quot;name&quot;: &quot;type&quot;,
      &quot;value&quot;: &quot;blacklist&quot;
    },
    {
      &quot;name&quot;: &quot;actual_dockerfile_only&quot;,
      &quot;value&quot;: &quot;true&quot;
    }
  ]
}
</code></pre><ol start=3><li>Warn if the user is not either &ldquo;nginx&rdquo; or &ldquo;jenkins&rdquo;</li></ol><pre><code>{
  &quot;gate&quot;: &quot;dockerfile&quot;,
  &quot;trigger&quot;: &quot;effective_user&quot;, 
  &quot;action&quot;: &quot;warn&quot;, 
  &quot;parameters&quot;: [ 
    {
      &quot;name&quot;: &quot;users&quot;,
      &quot;value&quot;: &quot;nginx,jenkins&quot;
    }, 
    {
      &quot;name&quot;: &quot;type&quot;,
      &quot;value&quot;: &quot;whitelist&quot;
    }
  ]
}
</code></pre><h3 id=trigger-exposed_ports>Trigger: exposed_ports</h3><p>This trigger processes the set of <code>EXPOSE</code> directives in the dockerfile/history to determine the set of ports that are defined to be exposed (since it can span multiple directives). It performs checks on that set to blacklist/whitelist them based on parameter settings.</p><h4 id=parameters-2>Parameters</h4><p><em>actual_dockerfile_only</em> (optional): See above</p><p><em>ports:</em> String of comma delimited port numbers to be checked</p><p><em>type:</em> The type of check to perform. One of: &lsquo;blacklist&rsquo; or &lsquo;whitelist&rsquo;. This determines how the value of the &lsquo;users&rsquo; parameter is interpreted</p><h4 id=examples-2>Examples</h4><ol><li>Allow only ports 80 and 443. Trigger will fire on any port defined to be exposed that is not 80 or 443</li></ol><pre><code>{
  &quot;gate&quot;: &quot;dockerfile&quot;,
  &quot;trigger&quot;: &quot;exposed_ports&quot;, 
  &quot;action&quot;: &quot;warn&quot;, 
  &quot;parameters&quot;: [ 
    {
      &quot;name&quot;: &quot;ports&quot;,
      &quot;value&quot;: &quot;80,443&quot;
    }, 
    {
      &quot;name&quot;: &quot;type&quot;,
      &quot;value&quot;: &quot;whitelist&quot;
    }
  ]
}
</code></pre><ol start=2><li>Blacklist ports 21 (ftp), 22 (ssh), and 53 (dns) . Trigger will fire a match on ports 21, 22, 53 if found in EXPOSE directives</li></ol><pre><code>{
  &quot;gate&quot;: &quot;dockerfile&quot;,
  &quot;trigger&quot;: &quot;exposed_ports&quot;, 
  &quot;action&quot;: &quot;warn&quot;, 
  &quot;parameters&quot;: [ 
    {
      &quot;name&quot;: &quot;ports&quot;,
      &quot;value&quot;: &quot;21,22,53&quot;
    }, 
    {
      &quot;name&quot;: &quot;type&quot;,
      &quot;value&quot;: &quot;blacklist&quot;
    }
  ]
}
</code></pre><h3 id=trigger-no_dockerfile_provided>Trigger: no_dockerfile_provided</h3><p>This trigger allows checks on the way the image was added, firing if the dockerfile was not explicitly provided at analysis time. This is useful in identifying and qualifying other trigger matches.</p><h4 id=parameters-3>Parameters</h4><p>None</p><h4 id=examples-3>Examples</h4><ol><li>Raise a warning if no dockerfile was provided at analysis time</li></ol><pre><code>{
  &quot;gate&quot;: &quot;dockerfile&quot;,
  &quot;trigger&quot;: &quot;no_dockerfile_provided&quot;, 
  &quot;action&quot;: &quot;warn&quot;, 
  &quot;parameters&quot;: [] 
}
</code></pre><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="feedback--answer feedback--answer-yes">Yes</button>
<button class="feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/nextlinux/nextlinux-engine/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/nextlinux/nextlinux-engine/issues/new>tell us how we can improve</a>.</p><script>const yesButton=document.querySelector('.feedback--answer-yes');const noButton=document.querySelector('.feedback--answer-no');const yesResponse=document.querySelector('.feedback--response-yes');const noResponse=document.querySelector('.feedback--response-no');const disableButtons=()=>{yesButton.disabled=true;noButton.disabled=true;};const sendFeedback=(value)=>{if(typeof ga!=='function')return;const args={command:'send',hitType:'event',category:'Helpful',action:'click',label:window.location.pathname,value:value};ga(args.command,args.hitType,args.category,args.action,args.label,args.value);};yesButton.addEventListener('click',()=>{yesResponse.classList.add('feedback--response__visible');disableButtons();sendFeedback(1);});noButton.addEventListener('click',()=>{noResponse.classList.add('feedback--response__visible');disableButtons();sendFeedback(0);});</script><br><div class="text-muted mt-5 pt-3 border-top">Last modified November 23, 2020: <a href=https://github.com/nextlinux/nextlinux-engine/commit/9dabbe730868b41c29991115d761b9a59933389c>Initial rough impl adding engine docs directory (9dabbe73)</a></div></div></main></div></div><footer class="bg-dark py-4 row d-print-none"><div class="container-fluid mx-sm-3"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack><a class=link-white target=_blank href=https://nextlinux.com/slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub><a class=link-white target=_blank href=https://github.com/nextlinux/nextlinux-engine><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Anchore, Inc."><a class=link-white target=_blank href=https://nextlinux.com><i class="fas fa-university"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 Anchore Inc All Rights Reserved</small>
<small class=ml-1><a href=https://nextlinux.com/privacy>Privacy Policy</a></small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/js/main.min.b4d3ede36a772c3819749f5af3fe521f735af2871639b3d6d5bfe26904c36057.js integrity="sha256-tNPt42p3LDgZdJ9a8/5SH3Na8ocWObPW1b/iaQTDYFc="></script></body></html>